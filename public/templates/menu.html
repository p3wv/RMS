{% extends "base.html" %}

{% block title %}Menu{% endblock %}

{% block page_content %}
<style>
    h1 {
        text-align: center;
        font-size: 2.5vw;
        padding-bottom: 1.5vw;
        border-bottom: 2px groove rgba(255, 255, 255, 0.322);
        font-weight: 400;
    }

    .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1.5vw;
        justify-items: center;
    }

    .menu-item {
        display: flex;
        flex-direction: column;
        align-items: center; 
    }

    .menu-item-details {
        display: flex;
        margin-bottom: 5px;
        padding: 5px;
    }

    .menu-item-name {
        font-weight: bold;
        margin-right: 5px;
    }


    .menu-item img {
        max-width: 60%;
        max-height: 60%;
        width: auto;
        height: auto;
        border: 2px solid #4CAF50;
        border-radius: 5px;
    }

    .pagination-item,
    .pagination-link {
        cursor: pointer;
        font-weight: 400;
        font-size: 2vw;
        margin: 0 1vw;
        padding: 0.8vw 2vw;
        color: tomato;
        background-color: transparent;
        border: 2px solid tomato;
        border-radius: 3%;
        text-decoration: none;
        transition: background-color 0.3s, color 0.3s;
    }

    .pagination-item:hover,
    .pagination-link:hover {
        background-color: tomato;
        color: white;
    }

    .pagination-item.active,
    .pagination-link.active {
        background-color: tomato;
        color: white;
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 2vw;
    }

    .add-to-cart-btn {
        background-color: #4CAF50;
        color: white;
        padding: 1vw 2vw;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .add-to-cart-btn:hover {
        background-color: #45a049;
    }

    .cart-status {
        text-align: center;
        font-size: 2vw;
        font-weight: 300;
        margin-top: 1.5vw;
        margin-bottom: 3vw;
    }

    #cart-count {
        font-weight: bold;
        font-style: italic;
        color: red;
        font-size: 2.5vw;
    }

    .notification-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #4CAF50;
        color: white;
        text-align: center;
        padding: 1.2vw;
        border-radius: 10px;
        z-index: 1;
        width: 30vw;
        max-width: 80%;
    }

    .buttons {
        display: flex;
        justify-content: flex-end;
        padding-bottom: 1.5vw;
        padding-right: 3vw;
        position: fixed;
        bottom: 50%;
        right: 3%;
        background-color: transparent;
    }

    .order-button {
        font-weight: 400;
        font-size: 2vw;
        font-style: italic;
        padding: 0.8vw 3vw;
        color: tomato;
        background-color: transparent;
        border: 2px solid tomato;
        border-radius: 3%;
        transition: background-color 0.3s, color 0.3s;
    }

    .order-button:hover {
        background-color: tomato;
        color: white;
        text-decoration: none;
    }

    @media screen and (max-width: 768px) {
        .menu-grid {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .menu-item img {
            max-width: 50%;
            max-height: 50%;
        }

        .pagination-link {
            font-size: 3vw;
            padding: 1vw 3vw;
            margin: 0 0.5vw;
        }

        .cart-status {
            font-size: 1.5vw;
            margin-top: 1vw;
            margin-bottom: 2vw;
        }

        #cart-count {
            font-size: 2vw;
        }

        .notification-popup {
            padding: 1.2vw;
            width: 60vw;
        }

        .buttons {
            padding-bottom: 1vw;
            padding-right: 2vw;
        }

        .order-button {
            font-size: 3vw;
            padding: 1vw 4vw;
        }
    }
</style>

<h1>Menu:</h1>

<div class="cart-status">
    <p>Your cart: <span id="cart-count"></span> items</p>
</div>

<div id="menu-list"></div>

<ul class="pagination" id="pagination">
</ul>

<div class="buttons">
    <a href="{{ url_for('main.cart') }}" class="order-button">ORDER <span>&#10145;</span></a>
</div>

<div id="notification-popup" class="notification-popup">
    Item has been added to your order
</div>

<script>
var menuData = [
    { 
        "id": 1, 
        "name": "Appetizer 1",
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/Appetizer-Tortilla-Pinwheels_EXPS_HCA17_8166_B12_15_4b-3.jpg?alt=media&token=2c531bc8-2dab-4855-80d8-50db680ce6bf",
        "price": 5.99 
    },
    { 
        "id": 2,
        "name": "Appetizer 2",
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/Cucumber-Shrimp-Appetizers-Square-1200-1.jpg?alt=media&token=f34a58cf-77a9-4c2b-a38d-6c6c9ed1b668",
        "price": 5.99
    },
    { 
        "id": 3, 
        "name": "Main Course 1", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/Rogan-Josh-1190644860.jpg?alt=media&token=2e082b99-4a22-4033-95da-ed9b24026a98", 
        "price": 5.99 
    },
    { 
        "id": 4, 
        "name": "Main Course 2", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/SARCIADONG-ISDA-Filipino-fish-dish-IMG2.jpg.webp?alt=media&token=c2e32b71-e4e4-4f39-91cd-7097f3834d3a", 
        "price": 5.99 
    },
    { 
        "id": 5, 
        "name": "Dessert 1", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/Strawberry-Water-006.webp?alt=media&token=0f216404-7228-42a9-a4f0-89597ead941f", 
        "price": 5.99 
    },
    { 
        "id": 6, 
        "name": "Dessert 2", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/easy-no-bake-desserts-645d1b63913ee.jpg?alt=media&token=9557e48d-6723-494a-b610-9b030b90880e", 
        "price": 5.99 
    },
    { 
        "id": 7, 
        "name": "Drinks 1", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/featured-starbucks-pink-drink-recipe.jpg?alt=media&token=73338b96-9cb0-477e-8157-174067a36f24", 
        "price": 5.99 
    },
    { 
        "id": 8, 
        "name": "Drinks 2", 
        "image": "https://firebasestorage.googleapis.com/v0/b/rms-pwa-f5c66.appspot.com/o/tiramisu-dessert-easy-vegan.jpg.webp?alt=media&token=4b7bbab0-333d-43c4-962c-d7aedb10f619", 
        "price": 5.99 
    }
];

const itemsPerPage = 4;
let currentPage = 1;

let cartItems = [];


document.addEventListener('DOMContentLoaded', function() {
    cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    displayMenu(currentPage);
    updateCartCount();
});


function getTotalQuantity() {
    let totalQuantity = 0;
    cartItems.forEach(item => {
        if (item && item.quantity != null) {
            totalQuantity += item.quantity;
        }
    });
    return totalQuantity;
}

function addToCart(cartItem) {
    const foundItem = cartItems.find(item => item.productId === cartItem.productId);
    if (foundItem) {
        foundItem.quantity = foundItem.quantity ? foundItem.quantity + 1 : 1;
    } else {
        cartItem.quantity = 1;
        cartItems.push(cartItem);
    }
    localStorage.setItem('cart', JSON.stringify(cartItems));
    updateCartCount();
    showSuccessNotification();
}

function onPageClick(page) {
    currentPage = page;
    displayMenu(currentPage);
}

function displayMenu(page) {
    const menuList = document.getElementById('menu-list');
    const pagination = document.getElementById('pagination');

    menuList.innerHTML = '';
    pagination.innerHTML = '';

    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const displayedItems = menuData.slice(startIndex, endIndex);

    const numColumns = Math.ceil(Math.sqrt(itemsPerPage));

    const gridContainer = document.createElement('div');
    gridContainer.className = 'menu-grid';
    gridContainer.style.gridTemplateColumns = `repeat(${numColumns}, 1fr)`;

    displayedItems.forEach((item, index) => {
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';

        const itemImage = document.createElement('img');
        itemImage.src = item.image;
        itemImage.alt = item.name;

        menuItem.appendChild(itemImage);

        const namePriceContainer = document.createElement('div');
        namePriceContainer.className = 'menu-item-details';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'menu-item-name';
        nameSpan.textContent = item.name;

        const priceSpan = document.createElement('span');
        priceSpan.className = 'menu-item-price';
        priceSpan.textContent = `$${item.price}`;

        const namePriceText = document.createTextNode(`${nameSpan.textContent} - ${priceSpan.textContent}`);

        namePriceContainer.appendChild(namePriceText);

        menuItem.appendChild(namePriceContainer);

        const addToCartButton = document.createElement('button');
        addToCartButton.textContent = 'Add to Cart';
        addToCartButton.className = 'add-to-cart-btn';
        addToCartButton.addEventListener('click', () => {
            const productId = item.id;
            const productName = item.name;
            const productImage = item.image;
            const price = item.price;

            const cartItem = {
                productId,
                productName,
                productImage,
                price
            };
            addToCart(cartItem);
            console.log(cartItems);
        });
        menuItem.appendChild(addToCartButton);

        gridContainer.appendChild(menuItem);
    });

    menuList.appendChild(gridContainer);

    const totalPages = Math.ceil(menuData.length / itemsPerPage);

    for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement('li');
        pageItem.textContent = i;
        pageItem.className = 'pagination-item';
        pageItem.addEventListener('click', () => onPageClick(i));
        pagination.appendChild(pageItem);
    }
}


function showSuccessNotification() {
    const notificationPopup = document.getElementById('notification-popup');
    notificationPopup.textContent = 'Item added to cart!';
    notificationPopup.style.display = 'block';
    setTimeout(() => {
        notificationPopup.style.display = 'none';
    }, 2000);
}


function updateCartCount() {
    const cartCountSpan = document.getElementById('cart-count');
    const totalQuantity = getTotalQuantity();
    cartCountSpan.textContent = totalQuantity;
}

</script>

{% endblock %}

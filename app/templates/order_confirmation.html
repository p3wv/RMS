{% extends "base.html" %}

{% block title %}Order Confirmation{% endblock %}

{% block page_content %}
<head>
    <style>
        .cart-item {
            margin-bottom: 20px;
            text-align: center;
        }

        .cart-item img {
            max-width: 100%;
            height: auto;
            width: 200px;
            height: 150px;
        }

        #delivery-form {
            max-width: 400px;
            margin: 20px auto;
        }

        #paypal-button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        #pay-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Order Confirmation</h1>

    <div id="cart-list"></div>

    <form id="delivery-form">
        <label for="address">Delivery Address:</label>
        <textarea id="address" name="address" rows="1" required></textarea>
        <br>
        <label for="name">Name:</label>
        <textarea id="name" name="address" rows="1" required></textarea>
        <br>
        <label for="surname">Surname:</label>
        <textarea id="surname" name="address" rows="1" required></textarea>
    </form>

    <div id="paypal-button-container"></div>
    <button id="pay-button" onclick="pay()">Pay with PayPal</button>

    <script src="https://www.paypal.com/sdk/js?client-id=AbJITLKvPRfdT6Y3Lcd7VLNLfa45bS8WQWQ7F3_Wq6WJTPlzqZMajdvoAfLuQxps1GJhdNGLAPBNG0_Z&currency=USD" data-sdk-integration-source="button-factory"></script>

    <script>
        // function displayCart() {
        //     // ... (your existing code)
        // }

        function initializePayPalButton() {
            paypal.Buttons({
                createOrder: function (data, actions) {
                    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
                    let totalAmount = cartItems.reduce((sum, item) => sum + item.price, 0);

                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: totalAmount.toFixed(2),
                                currency_code: 'USD'
                            }
                        }]
                    });
                },
                onApprove: function (data, actions) {
                    return actions.order.capture().then(function (details) {
                        localStorage.removeItem('cart');
                        displayCart(); 
                        alert('Transaction completed by ' + details.payer.name.given_name);
                    });
                },
                onError: function (err) {
                    console.error('Error:', err);
                    alert('There was an error processing the payment. Please try again.');
                }
            }).render('#paypal-button-container');
        }

        function pay() {
            // You can add additional logic here if needed before initiating PayPal payment
            document.getElementById('paypal-button-container').scrollIntoView();
            initializePayPalButton();
        }

        // ... (your existing code)

        // displayCart();
    </script>

</body>

{% endblock %}
